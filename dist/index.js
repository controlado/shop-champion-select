/**
 * @author balaclava
 * @name shop-champion-select
 * @link https://github.com/controlado/shop-champion-select
 * @description Buy champions inside Champion Select! ðŸ§
 */
import{layerManager,addRoutines,linkEndpoint,request,StoreBase,Champion}from"https://cdn.skypack.dev/balaclava-utils@latest";import trans from"./trans.json";import"./assets/style.css";class Store extends StoreBase{async getNotOwnedChampions(){return(await this.request("GET","/storefront/v3/view/champions")).data.catalog.filter((e=>!e.owned)).map((e=>({...e,name:e.name.toLowerCase()})))}}class Icon{constructor(e){this.element=document.createElement("div"),this.element.classList.add("mini-icon-champion"),this.img=document.createElement("img"),this.img.classList.add("mini-icon-img"),this.element.appendChild(this.img),this.store=e,this.champion=null}setChampion(e){this.champion=new Champion(e.itemId,e.ip),this.img.src=`/lol-game-data/assets/v1/champion-icons/${this.champion.id}.png`}show(){this.element.style.display="block"}hide(){this.element.style.display="none"}}class Tooltip{constructor(e){this.element=document.createElement("div"),this.element.setAttribute("id","lol-uikit-tooltip-root"),this.element.classList.add("tooltip","tooltip-random-champion");const t=document.createElement("lol-uikit-tooltip");t.setAttribute("data-tooltip-position",e),t.setAttribute("type","system");const n=document.createElement("lol-uikit-content-block");n.setAttribute("type","tooltip-system");const s=document.createElement("p");s.innerText=this.getLabel(),n.appendChild(s),t.appendChild(n),this.element.appendChild(t)}getLabel(){const e=document.body.dataset.lang;return trans.tooltip[e]||trans.tooltip[trans.missing]}show(e){const t=e.getBoundingClientRect();this.element.style.top=t.top+t.height-38+"px",this.element.style.left=`${t.left+t.width}px`,layerManager.appendChild(this.element)}hide(){layerManager.removeChild(this.element)}}class Input{constructor(e,t){this.element=document.querySelector(e),this.store=t,this.champions=[]}async refreshPlaceholder(){const e=await request("GET","/lol-inventory/v1/wallet/lol_blue_essence"),{lol_blue_essence:t}=await e.json();this.element.setAttribute("placeholder",`BE: ${t}`)}async updateChampions(){const e=new Event("input");this.champions=await this.store.getNotOwnedChampions(),this.element.dispatchEvent(e)}getSearchedChampions(){const e=this.element.value.toLowerCase();return this.champions.filter((t=>t.name.startsWith(e)))}}async function setupElements(e,t){const n=document.querySelector(e);if(!n||n.hasAttribute(t))return;n.setAttribute(t,"true");const s=new Store;await s.wait(400);const i=new Input(".champion-input",s);await Promise.all([i.refreshPlaceholder(),i.updateChampions()]);const o=new Icon(s);n.appendChild(o.element);const a=new Tooltip("right");o.element.addEventListener("mouseleave",(()=>a.hide())),o.element.addEventListener("mouseenter",(()=>a.show(o.element))),o.element.addEventListener("click",(()=>s.buyChampions(o.champion))),i.element.addEventListener("input",(()=>{const e=i.getSearchedChampions();1===e.length?(o.setChampion(...e),o.show()):o.hide()})),linkEndpoint("/lol-inventory/v1/wallet",(e=>{"Update"===e.eventType&&(i.refreshPlaceholder(),i.updateChampions())}))}addEventListener("load",(()=>{addRoutines((()=>setupElements(".champion-grid-header","shop-champion-select")))}));